<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HuggingFace API Test Suite</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
    }

    .header p {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .controls {
      padding: 30px;
      background: #f8f9fa;
      border-bottom: 2px solid #e9ecef;
      display: flex;
      gap: 15px;
      align-items: center;
      flex-wrap: wrap;
    }

    .btn {
      padding: 12px 30px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background: #667eea;
      color: white;
    }

    .btn-primary:hover {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
      background: #6c757d;
      color: white;
    }

    .btn-secondary:hover {
      background: #5a6268;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .summary {
      padding: 30px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
    }

    .stat-card {
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .stat-card.total {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .stat-card.passed {
      background: #d4edda;
      color: #155724;
    }

    .stat-card.failed {
      background: #f8d7da;
      color: #721c24;
    }

    .stat-card.warning {
      background: #fff3cd;
      color: #856404;
    }

    .stat-card.health {
      background: #d1ecf1;
      color: #0c5460;
    }

    .stat-number {
      font-size: 3em;
      font-weight: bold;
      margin: 10px 0;
    }

    .stat-label {
      font-size: 1em;
      opacity: 0.8;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .results {
      padding: 30px;
    }

    .test-item {
      padding: 15px 20px;
      margin-bottom: 10px;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.3s;
      border-left: 4px solid transparent;
    }

    .test-item:hover {
      transform: translateX(5px);
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .test-item.pass {
      background: #d4edda;
      border-left-color: #28a745;
    }

    .test-item.fail {
      background: #f8d7da;
      border-left-color: #dc3545;
    }

    .test-item.warning {
      background: #fff3cd;
      border-left-color: #ffc107;
    }

    .test-name {
      font-weight: 600;
      flex: 1;
    }

    .test-message {
      color: #666;
      font-size: 0.9em;
      margin-left: 20px;
      flex: 1;
    }

    .test-badge {
      padding: 6px 15px;
      border-radius: 20px;
      font-size: 0.85em;
      font-weight: bold;
      text-transform: uppercase;
    }

    .badge-pass {
      background: #28a745;
      color: white;
    }

    .badge-fail {
      background: #dc3545;
      color: white;
    }

    .badge-warning {
      background: #ffc107;
      color: #333;
    }

    .loading {
      text-align: center;
      padding: 50px;
      font-size: 1.2em;
      color: #666;
    }

    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .recommendations {
      padding: 30px;
      background: #f8f9fa;
      border-top: 2px solid #e9ecef;
    }

    .recommendations h3 {
      margin-bottom: 15px;
      color: #333;
    }

    .recommendation-item {
      padding: 12px 15px;
      margin-bottom: 10px;
      background: white;
      border-radius: 8px;
      border-left: 4px solid #667eea;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .critical-issues {
      padding: 30px;
      background: #fff5f5;
    }

    .critical-issues h3 {
      color: #dc3545;
      margin-bottom: 15px;
    }

    .issue-item {
      padding: 12px 15px;
      margin-bottom: 10px;
      background: white;
      border-radius: 8px;
      border-left: 4px solid #dc3545;
      color: #721c24;
    }

    .section-title {
      font-size: 1.5em;
      margin-bottom: 20px;
      color: #333;
      border-bottom: 2px solid #667eea;
      padding-bottom: 10px;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: #e9ecef;
      border-radius: 4px;
      overflow: hidden;
      margin-top: 10px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      transition: width 0.3s;
    }

    .json-output {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 20px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
      max-height: 400px;
      overflow: auto;
      margin-top: 20px;
    }

    pre {
      margin: 0;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üöÄ HuggingFace API Test Suite</h1>
      <p>Comprehensive Integration Testing for Crypto Data API</p>
      <p style="font-size: 0.9em; margin-top: 10px;">
        <strong>API:</strong> https://Really-amin-Datasourceforcryptocurrency-2.hf.space
      </p>
    </div>

    <div class="controls">
      <button class="btn btn-primary" id="runTests" onclick="runAllTests()">
        ‚ñ∂Ô∏è Run All Tests
      </button>
      <button class="btn btn-secondary" id="downloadReport" onclick="downloadReport()" disabled>
        üíæ Download JSON Report
      </button>
      <button class="btn btn-secondary" onclick="clearResults()">
        üóëÔ∏è Clear Results
      </button>
      <div style="flex: 1"></div>
      <span id="timer" style="font-weight: 600; color: #666;"></span>
    </div>

    <div id="summarySection" style="display: none;">
      <div class="summary" id="summary"></div>
    </div>

    <div id="loadingSection" style="display: none;" class="loading">
      <div class="spinner"></div>
      <p>Running tests... <span id="currentTest"></span></p>
      <div class="progress-bar">
        <div class="progress-fill" id="progressBar" style="width: 0%"></div>
      </div>
    </div>

    <div id="criticalSection" style="display: none;" class="critical-issues">
      <h3 class="section-title">üö® Critical Issues</h3>
      <div id="criticalIssues"></div>
    </div>

    <div id="resultsSection" style="display: none;" class="results">
      <h3 class="section-title">üìã Test Results</h3>
      <div id="results"></div>
    </div>

    <div id="recommendationsSection" style="display: none;" class="recommendations">
      <h3 class="section-title">üí° Recommendations</h3>
      <div id="recommendations"></div>
    </div>

    <div id="jsonSection" style="display: none;" class="results">
      <h3 class="section-title">üìÑ JSON Report</h3>
      <div class="json-output">
        <pre id="jsonOutput"></pre>
      </div>
    </div>
  </div>

  <script>
    const API_BASE = 'https://Really-amin-Datasourceforcryptocurrency-2.hf.space';
    let testReport = null;
    let startTime = 0;
    let timerInterval = null;

    const tests = [
      { name: 'System Health Check', url: '/api/health', validator: (d) => d.status === 'healthy' || d.status === 'ok' },
      { name: 'System Status', url: '/api/status' },
      { name: 'Router Registration', url: '/api/routers', validator: (d) => d.routers && d.routers.unified_service_api },
      { name: 'Get Single Rate (BTC/USDT)', url: '/api/service/rate?pair=BTC/USDT', validator: (d) => d.data && d.data.price },
      { name: 'Get Batch Rates', url: '/api/service/rate/batch?pairs=BTC/USDT,ETH/USDT,BNB/USDT', validator: (d) => Array.isArray(d.data) },
      { name: 'Get Top Coins', url: '/api/service/top?n=10', validator: (d) => d.data && Array.isArray(d.data) },
      { name: 'Get Market Status', url: '/api/service/market-status' },
      { name: 'Get Market Tickers', url: '/api/market/tickers?limit=10' },
      { name: 'Get OHLCV Data', url: '/api/ohlcv?symbol=BTC&timeframe=1h&limit=100', validator: (d) => d.success && Array.isArray(d.data) },
      { name: 'Get Historical Data', url: '/api/historical?symbol=BTC&days=7' },
      { name: 'Get Latest News', url: '/api/news/latest?limit=5', validator: (d) => Array.isArray(d.news) },
      { name: 'Get BTC News', url: '/api/news/latest?symbol=BTC&limit=5' },
      { name: 'Get Global Sentiment', url: '/api/sentiment/global' },
      { name: 'Get BTC Sentiment', url: '/api/service/sentiment?symbol=BTC' },
      { name: 'Get Whale Transactions', url: '/api/service/whales?chain=ethereum&min_amount_usd=1000000&limit=10', validator: (d) => Array.isArray(d.data) },
      { name: 'Get Gas Prices', url: '/api/blockchain/gas?chain=ethereum' },
      { name: 'Get Models Status', url: '/api/models/status' },
      { name: 'Get Resources Stats', url: '/api/resources/stats' }
    ];

    async function runTest(test) {
      try {
        const start = Date.now();
        const response = await fetch(`${API_BASE}${test.url}`, {
          signal: AbortSignal.timeout(30000)
        });
        const responseTime = Date.now() - start;

        if (!response.ok) {
          return {
            testName: test.name,
            status: 'FAIL',
            message: `HTTP ${response.status}`,
            details: { responseTime },
            timestamp: new Date().toISOString()
          };
        }

        const data = await response.json();

        if (test.validator && !test.validator(data)) {
          return {
            testName: test.name,
            status: 'FAIL',
            message: 'Response validation failed',
            details: { responseTime, data },
            timestamp: new Date().toISOString()
          };
        }

        return {
          testName: test.name,
          status: 'PASS',
          message: `Success (${responseTime}ms)`,
          details: { responseTime },
          timestamp: new Date().toISOString()
        };

      } catch (error) {
        return {
          testName: test.name,
          status: 'FAIL',
          message: error.message,
          details: { error: error.message },
          timestamp: new Date().toISOString()
        };
      }
    }

    async function runAllTests() {
      const runBtn = document.getElementById('runTests');
      runBtn.disabled = true;
      
      document.getElementById('summarySection').style.display = 'none';
      document.getElementById('loadingSection').style.display = 'block';
      document.getElementById('resultsSection').style.display = 'none';
      document.getElementById('criticalSection').style.display = 'none';
      document.getElementById('recommendationsSection').style.display = 'none';
      document.getElementById('jsonSection').style.display = 'none';

      startTime = Date.now();
      startTimer();

      const results = [];
      const progressBar = document.getElementById('progressBar');
      const currentTestEl = document.getElementById('currentTest');

      for (let i = 0; i < tests.length; i++) {
        const test = tests[i];
        currentTestEl.textContent = test.name;
        progressBar.style.width = ((i / tests.length) * 100) + '%';

        const result = await runTest(test);
        results.push(result);

        await new Promise(resolve => setTimeout(resolve, 500));
      }

      progressBar.style.width = '100%';
      stopTimer();

      generateReport(results);
      displayResults(results);

      runBtn.disabled = false;
      document.getElementById('downloadReport').disabled = false;
    }

    function generateReport(results) {
      const endTime = Date.now();
      const duration = endTime - startTime;

      const passed = results.filter(r => r.status === 'PASS').length;
      const failed = results.filter(r => r.status === 'FAIL').length;
      const warnings = results.filter(r => r.status === 'WARNING').length;

      let apiHealth = 'HEALTHY';
      if (failed > 5) apiHealth = 'DOWN';
      else if (failed > 0 || warnings > 3) apiHealth = 'DEGRADED';

      const criticalIssues = results
        .filter(r => r.status === 'FAIL')
        .map(r => `${r.testName}: ${r.message}`);

      const recommendations = [];
      if (failed > 0) {
        recommendations.push('Fix failing endpoints before deploying to production');
      }
      if (warnings > 0) {
        recommendations.push('Review warnings and resolve any code integration issues');
      }
      if (apiHealth === 'DOWN') {
        recommendations.push('CRITICAL: API is down or severely degraded. Do not deploy.');
      } else if (apiHealth === 'DEGRADED') {
        recommendations.push('API is degraded. Some features may not work properly.');
      } else {
        recommendations.push('All tests passed! API is healthy and ready for production.');
      }

      testReport = {
        totalTests: results.length,
        passed,
        failed,
        warnings,
        startTime: new Date(startTime).toISOString(),
        endTime: new Date(endTime).toISOString(),
        duration,
        results,
        summary: {
          apiHealth,
          criticalIssues,
          recommendations
        }
      };
    }

    function displayResults(results) {
      document.getElementById('loadingSection').style.display = 'none';
      document.getElementById('summarySection').style.display = 'block';
      document.getElementById('resultsSection').style.display = 'block';

      const summary = document.getElementById('summary');
      summary.innerHTML = `
        <div class="stat-card total">
          <div class="stat-label">Total Tests</div>
          <div class="stat-number">${testReport.totalTests}</div>
        </div>
        <div class="stat-card passed">
          <div class="stat-label">Passed</div>
          <div class="stat-number">${testReport.passed}</div>
        </div>
        <div class="stat-card failed">
          <div class="stat-label">Failed</div>
          <div class="stat-number">${testReport.failed}</div>
        </div>
        <div class="stat-card health">
          <div class="stat-label">API Health</div>
          <div class="stat-number" style="font-size: 1.5em;">${testReport.summary.apiHealth}</div>
        </div>
      `;

      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = results.map(r => `
        <div class="test-item ${r.status.toLowerCase()}">
          <div class="test-name">${r.testName}</div>
          <div class="test-message">${r.message}</div>
          <div class="test-badge badge-${r.status.toLowerCase()}">${r.status}</div>
        </div>
      `).join('');

      if (testReport.summary.criticalIssues.length > 0) {
        document.getElementById('criticalSection').style.display = 'block';
        document.getElementById('criticalIssues').innerHTML = 
          testReport.summary.criticalIssues.map(issue => `
            <div class="issue-item">‚ö†Ô∏è ${issue}</div>
          `).join('');
      }

      if (testReport.summary.recommendations.length > 0) {
        document.getElementById('recommendationsSection').style.display = 'block';
        document.getElementById('recommendations').innerHTML = 
          testReport.summary.recommendations.map(rec => `
            <div class="recommendation-item">üí° ${rec}</div>
          `).join('');
      }

      document.getElementById('jsonSection').style.display = 'block';
      document.getElementById('jsonOutput').textContent = JSON.stringify(testReport, null, 2);
    }

    function downloadReport() {
      if (!testReport) return;

      const dataStr = JSON.stringify(testReport, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `api-test-report-${Date.now()}.json`;
      link.click();
      URL.revokeObjectURL(url);
    }

    function clearResults() {
      testReport = null;
      document.getElementById('summarySection').style.display = 'none';
      document.getElementById('resultsSection').style.display = 'none';
      document.getElementById('criticalSection').style.display = 'none';
      document.getElementById('recommendationsSection').style.display = 'none';
      document.getElementById('jsonSection').style.display = 'none';
      document.getElementById('downloadReport').disabled = true;
    }

    function startTimer() {
      timerInterval = setInterval(() => {
        const elapsed = Date.now() - startTime;
        const seconds = Math.floor(elapsed / 1000);
        const minutes = Math.floor(seconds / 60);
        const remainingSeconds = seconds % 60;
        document.getElementById('timer').textContent = 
          `‚è±Ô∏è ${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
      }, 100);
    }

    function stopTimer() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
    }
  </script>
</body>
</html>